<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHK & Lua 協作紀念碑 - 旗艦版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-20px) rotate(5deg); } }
        @keyframes pulse-ring { 0% { transform: scale(0.8); opacity: 0.5; } 100% { transform: scale(1.5); opacity: 0; } }
        @keyframes orbit { from { transform: rotate(0deg) translateX(100px) rotate(0deg); } to { transform: rotate(360deg) translateX(100px) rotate(-360deg); } }
        
        .reactor-core {
            background: radial-gradient(circle, rgba(59, 130, 246, 0.3) 0%, rgba(15, 23, 42, 0) 70%);
        }
        .glass {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .animate-float { animation: float 6s ease-in-out infinite; }
        .pulse-ring { animation: pulse-ring 3s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite; }
        .tech-grid {
            background-image: radial-gradient(#3b82f6 1px, transparent 1px);
            background-size: 32px 32px;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex items-center justify-center p-4 md:p-12 font-sans selection:bg-blue-500/30">

    <div id="app" class="max-w-5xl w-full glass rounded-3xl shadow-2xl overflow-hidden relative border border-blue-500/20">
        <!-- 裝飾用背景粒子 -->
        <div class="absolute inset-0 opacity-10 pointer-events-none tech-grid"></div>

        <div class="flex flex-col lg:flex-row">
            <!-- 左側：動態視覺區 -->
            <div class="lg:w-1/2 bg-slate-900/50 p-8 md:p-12 flex flex-col items-center justify-center relative min-h-[500px] border-r border-white/5">
                
                <!-- 圖片顯示層 -->
                <div id="image-display" class="absolute inset-0 z-20 hidden opacity-0 transition-opacity duration-1000">
                    <img id="result-image" class="w-full h-full object-cover" src="" alt="AI Generated Collaboration">
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-transparent"></div>
                    <button onclick="resetView()" class="absolute bottom-4 right-4 p-2 bg-slate-800/80 hover:bg-slate-700 rounded-lg text-xs text-slate-300 backdrop-blur-md border border-white/10">
                        <i data-lucide="refresh-cw" class="w-3 h-3 inline mr-1"></i> 重設
                    </button>
                </div>

                <!-- 互動核心與生成控制 -->
                <div id="core-visual" class="relative z-10 flex flex-col items-center">
                    <div class="relative w-64 h-64 flex items-center justify-center mb-12">
                        <div class="absolute inset-0 border-2 border-blue-500/30 rounded-full pulse-ring"></div>
                        <div class="relative z-10 p-8 bg-blue-600/10 rounded-full border border-blue-400/30 animate-float shadow-[0_0_50px_rgba(59,130,246,0.2)]">
                            <i data-lucide="sparkles" id="main-icon" class="w-20 h-20 text-blue-400"></i>
                        </div>
                        <!-- 繞軌運行的組件 -->
                        <div class="absolute w-10 h-10 bg-slate-800 border border-blue-500/50 rounded-lg flex items-center justify-center shadow-lg" style="animation: orbit 10s linear infinite;">
                            <i data-lucide="code" class="w-5 h-5 text-blue-400"></i>
                        </div>
                    </div>

                    <div id="status-text" class="text-center mb-6">
                        <h3 class="text-xl font-bold text-white mb-2 uppercase tracking-tighter">系統已就緒</h3>
                        <p class="text-slate-400 text-xs max-w-xs">點擊下方按鈕，讓 AI 為我們的 AHK & Lua 協作繪製專屬意象圖。</p>
                    </div>

                    <button id="gen-btn" onclick="startGeneration()" class="px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold shadow-lg shadow-blue-900/20 transition-all active:scale-95 flex items-center gap-2">
                        <i data-lucide="wand-2" class="w-5 h-5"></i>
                        啟動 AI 繪圖
                    </button>
                    
                    <div id="loading-indicator" class="hidden flex flex-col items-center gap-3">
                        <i data-lucide="loader-2" class="w-10 h-10 text-blue-500 animate-spin"></i>
                        <p class="text-blue-400 text-xs font-mono animate-pulse">GENERATING IMAGERY...</p>
                    </div>
                </div>
            </div>

            <!-- 右側：成就描述 -->
            <div class="lg:w-1/2 p-8 md:p-12 flex flex-col justify-center bg-slate-900/30">
                <div class="flex items-center gap-2 mb-6">
                    <div class="h-px w-8 bg-blue-500"></div>
                    <span class="text-xs font-bold text-blue-500 tracking-widest uppercase">Development Archive</span>
                </div>

                <h1 class="text-4xl font-extrabold text-white mb-6 leading-tight">
                    數位協作的<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400">邏輯紀念碑</span>
                </h1>

                <p class="text-slate-400 mb-8 leading-relaxed text-sm">
                    這次更新強化了 AI 繪圖的呼叫邏輯。我們利用 <strong>Imagen 4.0</strong> 模型，將抽象的 AHK 腳本與 Lua 邏輯轉化為視覺藝術。
                </p>

                <div class="space-y-4">
                    <div class="p-4 bg-slate-800/40 rounded-2xl border border-white/5 group hover:border-blue-500/30 transition-all">
                        <div class="flex items-center gap-3 mb-2">
                            <i data-lucide="mouse-pointer-2" class="w-5 h-5 text-blue-400"></i>
                            <h4 class="text-sm font-bold text-white uppercase">AHK 互動組件</h4>
                        </div>
                        <p class="text-xs text-slate-500">處理 GUI、DPI 補償與指令傳遞的核心橋樑。</p>
                    </div>

                    <div class="p-4 bg-slate-800/40 rounded-2xl border border-white/5 group hover:border-indigo-500/30 transition-all">
                        <div class="flex items-center gap-3 mb-2">
                            <i data-lucide="database" class="w-5 h-5 text-indigo-400"></i>
                            <h4 class="text-sm font-bold text-white uppercase">Lua 邏輯框架</h4>
                        </div>
                        <p class="text-xs text-slate-500">提供自動存檔、物件導向管理與 JSON 持久化的數據中心。</p>
                    </div>
                </div>

                <div class="mt-10 pt-6 border-t border-white/5 flex items-center justify-between text-[10px] font-mono text-slate-600">
                    <div>BUILD: v2.0.0 ULTRA</div>
                    <div class="flex items-center gap-1">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        SYSTEM ONLINE
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // API 配置
        const apiKey = ""; 
        const promptText = "A stunning high-tech digital workspace. Blue energy flows between a glowing AHK gear and a complex Lua code matrix. Futuristic Rainmeter UI widgets float in the air. Professional lighting, 8k resolution, cinematic atmosphere, blue and gold color scheme.";

        async function startGeneration() {
            const genBtn = document.getElementById('gen-btn');
            const loadingInd = document.getElementById('loading-indicator');
            const statusText = document.getElementById('status-text');
            const mainIcon = document.getElementById('main-icon');

            // UI 狀態切換
            genBtn.classList.add('hidden');
            loadingInd.classList.remove('hidden');
            statusText.classList.add('opacity-50');
            mainIcon.classList.add('animate-spin');

            const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;
            
            // 嚴格遵循規範的 Payload 格式
            const payload = {
                instances: { prompt: promptText },
                parameters: { sampleCount: 1 }
            };

            let retries = 0;
            const maxRetries = 5;

            const attemptFetch = async () => {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error('Generation failed');

                    const result = await response.json();
                    if (result.predictions && result.predictions[0]) {
                        showImage(`data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`);
                    } else {
                        throw new Error('No image data');
                    }
                } catch (err) {
                    if (retries < maxRetries) {
                        retries++;
                        setTimeout(attemptFetch, Math.pow(2, retries) * 1000);
                    } else {
                        handleError();
                    }
                }
            };

            attemptFetch();
        }

        function showImage(src) {
            const display = document.getElementById('image-display');
            const img = document.getElementById('result-image');
            const core = document.getElementById('core-visual');

            img.src = src;
            display.classList.remove('hidden');
            core.classList.add('hidden');
            setTimeout(() => {
                display.classList.add('opacity-100');
            }, 100);
        }

        function handleError() {
            const loadingInd = document.getElementById('loading-indicator');
            const statusText = document.getElementById('status-text');
            const genBtn = document.getElementById('gen-btn');
            
            loadingInd.classList.add('hidden');
            genBtn.classList.remove('hidden');
            statusText.classList.remove('opacity-50');
            statusText.innerHTML = `<h3 class="text-red-400 font-bold">生成暫時失敗</h3><p class="text-slate-500 text-xs">可能是環境密鑰尚未準備就緒，請稍後重試。</p>`;
        }

        function resetView() {
            location.reload();
        }
    </script>
</body>
</html>